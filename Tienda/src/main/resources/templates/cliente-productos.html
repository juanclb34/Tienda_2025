<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Catálogo de Productos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body class="bg-light">
<div class="container mt-5">
    <h2 class="mb-4 text-center">Catálogo de Productos</h2>

    <!-- Formulario de búsqueda -->
    <form id="formBusqueda" class="row g-3 mb-4">
        <div class="col-md-3">
            <input type="text" id="nombre" class="form-control" placeholder="Nombre" />
        </div>
        <div class="col-md-3">
            <input type="text" id="categoria" class="form-control" placeholder="Categoría" />
        </div>
        <div class="col-md-2">
            <input type="number" id="precioMin" class="form-control" placeholder="Precio Min" min="0" step="0.01" />
        </div>
        <div class="col-md-2">
            <input type="number" id="precioMax" class="form-control" placeholder="Precio Max" min="0" step="0.01" />
        </div>
        <div class="col-md-2 d-grid">
            <button type="submit" class="btn btn-primary">Buscar</button>
        </div>
    </form>

    <!-- Tabla resultados -->
    <table class="table table-striped" id="tablaResultados">
        <thead class="table-dark">
        <tr>
            <th>Nombre</th>
            <th>Categoría</th>
            <th>Precio</th>
            <th>Stock</th>
        </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<script>
document.getElementById("formBusqueda").addEventListener("submit", function(e) {
    e.preventDefault();

    let params = new URLSearchParams();

    const nombre = document.getElementById("nombre").value.trim();
    const categoria = document.getElementById("categoria").value.trim();
    const precioMin = document.getElementById("precioMin").value.trim();
    const precioMax = document.getElementById("precioMax").value.trim();

    if (nombre) params.append("nombre", nombre);
    if (categoria) params.append("categoria", categoria);
    if (precioMin) params.append("precioMin", precioMin);
    if (precioMax) params.append("precioMax", precioMax);

    fetch("/cliente/productos/buscar?" + params.toString())
        .then(res => {
            if (!res.ok) throw new Error("Error en la búsqueda");
            return res.json();
        })
        .then(data => {
            const tbody = document.querySelector("#tablaResultados tbody");
            tbody.innerHTML = "";

            if (data.length === 0) {
                tbody.innerHTML = `<tr><td colspan="4" class="text-center">No se encontraron productos</td></tr>`;
                return;
            }

            data.forEach(p => {
                const fila = `
                    <tr>
                        <td>${p.nombre}</td>
                        <td>${p.categoria}</td>
                        <td>₡${p.precio.toFixed(2)}</td>
                        <td>${p.stock}</td>
                    </tr>
                `;
                tbody.innerHTML += fila;
            });
        })
        .catch(err => {
            console.error(err);
            alert("Hubo un error realizando la búsqueda");
        });
});
</script>
</body>
</html>
